---
title: "Data Project Team GoBills"
author: "STAT 420, Summer 2023, Naveen Baskaran (nc42), Frank Salamone (frankns2), Aleksandr Stpenko(as99)"
date: ''
output:
  html_document:
    theme: readable
    toc: yes
  word_document:
    toc: yes
  pdf_document: default
urlcolor: cyan
---


***

### 1. The names of the students who will be contributing to the group project.

Naveen Baskaran (nc42)
Frank Salamone (frankns2)
Aleksandr Stepenko (as99)

### 2. A tentative title for the project.

“Predicting Airbnb Prices in London on Weekends”

### 3. Description of the data file (what they contain including number of variables and number of records). You do not necessarily have to list all the variables, but at least mention those of greatest importance.

Our dataset concerns Airbnb rentals in London on the weekends.  It contains 19 variables in this dataset with 5379 records. These records consist of information regarding the characteristics of each rental, and the total price of the listing.  Our dataset is a subset of a larger collection of Airbnb listings in many European cities.

The most important variable is realSum, which is the total price of the listing, and will serve as our response.  There are many categorical variables, including, most importantly,  room_type, room_shared, and host_is_superhost.  The distance to city center, dist, and metro_dist, the distance to the nearest metro station, will be important continuous numeric variables.  

### 4. Background information on the data sets, including specific citation of their source (so that I can also access it).

This dataset was found on Kaggle. Briefly, it is a part of a larger set of Airbnb prices in European cities.  Please see the dataset description below (taken from Kaggle).

https://www.kaggle.com/datasets/thedevastator/airbnb-prices-in-european-cities?resource=download

“This dataset provides a comprehensive look at Airbnb prices in some of the most popular European cities. Each listing is evaluated for various attributes such as room types, cleanliness and satisfaction ratings, bedrooms, distance from the city center, and more to capture an in-depth understanding of Airbnb prices on both weekdays and weekends. Using spatial econometric methods, we analyze and identify the determinants of Airbnb prices across these cities. Our dataset includes information such as realSum (the total price of the listing), room_type (private/shared/entire home/apt), host_is_superhost (boolean value indicating if host is a superhost or not), multi (indicator whether listing is for multiple rooms or not), biz (business indicator) , guest_satisfaction_overall (overall rating from guests comparing all listings offered by host ), bedrooms, dist (distance from city center) , lng & lat coordinates for location identification etc. We hope that this data set offers insight into how global markets are affected by social dynamics and geographical factors which in turn determine pricing strategies for optimal profitability!”

### 5. A brief statement of the business, science, research, or personal interest you have in the data set which you hope to explore. 

From an outsider’s perspective, the Airbnb platform has revolutionized the renting of rooms much as Uber has revolutionized ridesharing.  Airbnb allows users of the platform to monetize property that they would not be able to otherwise.  In order to determine if renting out a room is a good business case or worth the owner’s time, it would be helpful to have an estimate of how much income the room would generate.  Our proposal is to develop a model, trained on the London Weekend Airbnb data, that could predict the room rental income based on predictors known to the person putting the room up for rent.  

### 6. Evidence that the data can be loaded into R. Load the data, and print the first few values of the response variable as evidence.

**Solution**

```{r}
df = read.csv("london_weekends.csv")
df = df[, !(names(df) %in% 'X')]

nrow(df)
ncol(df)

head(df, 5)
```


Methods
First part:
Exploratory analysis.  Lay out what variables look like they are related to the response through correlation
analysis.  Scatterplot matrix.  Basic analysis.  Hint on possibility of collinearity.
Second part:
Some connector between predictors and response in linear fashon.  Main effects analysis.
Aren't completely happy.  Give RMSE, RSE, adjusted r^2.
Next try to remove predictors to increase explanatory power.
Third part:
Try transformations, interactions.  Polynomial terms.
Do backward elimination from your big model from above.
Go in same order as introduced in the course.
Results
Dont' characterize all models.  2 or 3 or 4models that seem to be the best.  Say why fully additive model
didn't work.  Show progress that you made.  End results.  Hit the highlights.
Discussion
Table with candidate model, with RMSC, residuals, assumptions.  Argue why model is the best.

## Introduction

rubric:  Introduction  Lay everything out in terms of data.  Objective of what want to learn about data.

From an outsider’s perspective, the Airbnb platform has revolutionized the renting of rooms much as Uber has revolutionized ridesharing.  Airbnb allows users of the platform to monetize property that they would not be able to otherwise.  In order to determine if renting out a room is a good business case or worth the owner’s time, it would be helpful to have an estimate of how much income the room would generate.  Our proposal is to develop a model, trained on the London Weekend Airbnb data, that could predict the room rental income based on predictors known to the person putting the room up for rent.  The data is available on Kaggle at https://www.kaggle.com/datasets/thedevastator/airbnb-prices-in-european-cities, and from the original authors, Gyódi, Kristóf and Nawaro, Łukasz at https://zenodo.org/record/4446043#.Y9Y9ENJBwUE.

The columns of the database include:

realSum: the full price of accommodation for two people and two nights in EUR
room_type: the type of the accommodation 
room_shared: dummy variable for shared rooms
room_private: dummy variable for private rooms
person_capacity: the maximum number of guests 
host_is_superhost: dummy variable for superhost status
multi: dummy variable if the listing belongs to hosts with 2-4 offers
biz: dummy variable if the listing belongs to hosts with more than 4 offers
cleanliness_rating: cleanliness rating
guest_satisfaction_overall: overall rating of the listing
bedrooms: number of bedrooms (0 for studios)
dist: distance from city centre in km
metro_dist: distance from nearest metro station in km
attr_index: attraction index of the listing location
attr_index_norm: normalised attraction index (0-100)
rest_index: restaurant index of the listing location
attr_index_norm: normalised restaurant index (0-100)
lng: longitude of the listing location
lat: latitude of the listing location

*What are the dimensions of the dataset?*

```{r}
nrow(df)
ncol(df)
```

There are 5379 rows of data with 20 variables, as described above.

## Methods

Rubric:
Methods
First part:
Exploratory analysis.  Lay out what variables look like they are related to the response through correlation
analysis.  Scatterplot matrix.  Basic analysis.  Hint on possibility of collinearity.
Second part:
Some connector between predictors and response in linear fashon.  Main effects analysis.
Aren't completely happy.  Give RMSE, RSE, adjusted r^2.
Next try to remove predictors to increase explanatory power.
Third part:
Try transformations, interactions.  Polynomial terms.
Do backward elimination from your big model from above.
Go in same order as introduced in the course.


# Data Exploratiom -> Data Cleaning -> Model Building -> Present Results


## Exploratory Analysis

```{r}
head(df, 5)
```

*Dataset dimensions*
```{r}
nrow(df)
ncol(df)
```

*The structure of the dataset*
```{r}
str(df)
```
*The summary statistics of the dataset*
```{r}
summary(df)
```

*Missing values in the dataset*
```{r}
colSums(is.na(df))
```

*Numerical/Categorical variables*
```{r}
target = 'realSum'
numerical_vars = c('dist', 'metro_dist', 'attr_index', 'attr_index_norm', 'rest_index', 'rest_index_norm', 'lng', 'lat') #sapply(df, is.numeric)
categorical_vars = names(df)[!names(df) %in% numerical_vars]
```

*Remove outliers*
```{r}
# Interquartile Range method (IQR)
get_outliers_idx = function(data) {
  Q1 = quantile(data, 0.25)
  Q3 = quantile(data, 0.75)
  
  IQR = Q3 - Q1
  
  lower_bound = Q1 - 1.5 * IQR
  upper_bound = Q3 + 1.5 * IQR
  
  idx = which(data < lower_bound | data > upper_bound)
  
  return(idx)
}

```

```{r}
library(dplyr)

idx = c()
for (col in numerical_vars) {
 idx = union(idx, get_outliers_idx(df[[col]]))
}
df = df[-idx,]
print(length(idx))
```
*Numerical variables: hist*
```{r}
# par(mfrow = c(1, length(numerical_vars)))
for (col in numerical_vars) {
  hist(df[[col]], main = col, xlab = "Value", ylab = "Frequency")
}
```



*The relationship between variables*

*Correlation*
```{r}
library(corrplot)

cor_mx = cor(df[numerical_vars])

corrplot(cor_mx, method = "color")
```


*Pairplots*
```{r}
pairs(df[numerical_vars])
```
*Categorical variables*
```{r}

for (col in categorical_vars) {
  print(col)
  boxplot(realSum ~ df[[col]], data = df, 
        main = paste0("realSum vs. ", col), 
        xlab = "Room Type", 
        ylab = "Real Sum")
}


```

*The distribution of the target variable*
```{r}
MIN_VALUE = 0
MAX_VALUE = 3000
NUM_BINS = 15

bin_width = (MAX_VALUE - MIN_VALUE) / NUM_BINS

breakpoints = seq(MIN_VALUE, MAX_VALUE, by = bin_width)

hist(df$realSum[df$realSum < MAX_VALUE],
     main = "Distribution of realSum",
     xlab = "Real Sum",
     ylab = "Frequency",
     breaks = breakpoints)
```



***

## Data Cleaning

There are several variables that need to be converted to factors.  These include: room_type, room_shared, room_private, and host_is_superhost.  

```{r}
unique(df$room_type) 
unique(df$room_shared)
unique(df$room_private)
unique(df$host_is_superhost)
```

The room_type column can converted into a 3 level factor variable with the levels being: "Private room", "Entire home/apt", and "Shared room".

Another question is if room_shared and room_private are independent.

```{r}
mean(df$room_shared == df$room_private)
```

Based on the data, they mean different things.

Columns multi and biz are factors stored as integers.

```{r}
unique(df$multi)
unique(df$biz)
```

Switch these to True and False.

```{r}
df$multi[df$multi == 0] = "False"
df$multi[df$multi == 1] = "True"
df$biz[df$biz == 0] = "False"
df$biz[df$biz == 1] = "True"
```

The bedrooms and person_capacity column should also be changed to a factor.

```{r}
unique(df$bedrooms)
unique(df$person_capacity)
```

Switch all to factors.

```{r}
df$room_type = as.factor(df$room_type)
df$room_shared = as.factor(df$room_shared)
df$room_private = as.factor(df$room_private)
df$person_capacity = as.factor(df$person_capacity)
df$host_is_superhost = as.factor(df$host_is_superhost)
df$multi = as.factor(df$multi)
df$biz = as.factor(df$biz)
df$bedrooms = as.factor(df$bedrooms)
head(df)
```

attr_index and attr_index_norm will be colinear, as will rest_index and rest_index_norm, so the non-normalized columns.

```{r}
cor(df$attr_index, df$attr_index_norm)
df = subset(df, select = -c(attr_index, rest_index))
```


See if there are any NAs:

```{r}
# sum(is.na(df))
colSums(is.na(df))
```

***

```{r}
london_numeric = subset(df, select = c(cleanliness_rating, guest_satisfaction_overall, dist, metro_dist, attr_index_norm, rest_index_norm))
pairs(london_numeric)
```

Some of these data show colinearity and some are look non-linear.

Let us first check for colinearity.


```{r}
full_mod = lm(realSum ~ ., data = df)
summary(full_mod)
```

It looks like room_shared and room_private have exact colinearity with room_type, so let us remove them.

```{r}
full_a = lm(realSum ~ . - room_shared - room_private, data = df)
summary(full_a)
```


Check variance inflation factors.

```{r}
library(faraway)
vif(full_a)
vif(full_a)[unname(vif(full_a)) > 5]
``` 

The variables with VIF values more than 5 include dist, attr_index_norm, and rest_index_norm. This makes sense as dist is the distance to the city center, and it is likely if this is small, the number of attractions and restaurants (as measured by attr_index_norm and rest_index_norm) would be high.  Also, metro_dist, the distance to a metro station, would likely be small if dist is small. 

What does the distribution of the room prices look like?

```{r}
hist(df$realSum)
```

Maybe this would look better if we took the logarithm.  

```{r}
hist(log(df$realSum))
```

This does look much better.  Let us try to fit a model with the log transformation of the response.

```{r}
full_a = lm(log(realSum) ~ . - room_shared - room_private, data = df)
summary(full_a)
```

Lets do a model with interactions, and then reduce the number of variables with backward AIC.

```{r}
full_interact = lm(log(realSum) ~ (. - room_shared - room_private)^2, data = df)
summary(full_interact)
```


***

